<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Multi Downloader ‚Äî Aanz</title>
  <style>
    body{
      margin:0;
      font-family:"Inter",sans-serif;
      background:linear-gradient(135deg,#0d1b2a,#1b263b);
      color:#f1f5f9;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px;
    }
    .box{
      width:100%;
      max-width:880px;
      background:rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.05);
      border-radius:18px;
      backdrop-filter:blur(12px);
      box-shadow:0 20px 50px rgba(0,0,0,0.6);
      padding:28px;
    }
    h1{margin:0 0 4px;font-size:26px;font-weight:700;color:#e0f2fe}
    p{margin:0;color:rgba(241,245,249,0.65);font-size:14px}
    .row{display:flex;gap:12px;margin-top:18px}
    select,input,button{
      padding:12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.08);
      font-size:14px;
      outline:none;
    }
    select,input{
      flex:1;
      background:rgba(255,255,255,0.05);
      color:#f1f5f9;
    }
    button{
      background:linear-gradient(90deg,#38bdf8,#6366f1);
      color:#0f172a;
      font-weight:700;
      cursor:pointer;
      box-shadow:0 8px 20px rgba(56,189,248,0.25);
    }
    .preview{
      margin-top:18px;
      border-radius:12px;
      overflow:hidden;
      background:#000;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:220px;
      color:#94a3b8;
      text-align:center;
    }
    .actions{display:flex;gap:12px;margin-top:14px}
    .actions button{
      flex:1;
      background:#1e293b;
      color:#f8fafc;
      box-shadow:none;
    }
    footer{margin-top:20px;text-align:center;font-size:13px;color:#94a3b8}
  </style>
</head>
<body>
  <div class="box">
    <h1>All-in-One Downloader</h1>
    <p>Pilih platform lalu tempel URL untuk mengunduh video.</p>

    <div class="row">
      <select id="platform">
        <option value="ytmp4">YouTube (MP4)</option>
        <option value="instagram">Instagram</option>
        <option value="tiktok">TikTok</option>
      </select>
      <input type="text" id="urlInput" placeholder="Tempel URL disini...">
      <button id="fetchBtn">Fetch</button>
    </div>

    <div id="preview" class="preview">Preview akan muncul disini</div>

    <div class="actions">
      <button id="downloadBtn" style="display:none">‚¨áÔ∏è Download</button>
      <button id="openBtn" style="display:none">üîó Buka</button>
    </div>

    <footer>&lt;/&gt; 2025 Aanz</footer>
  </div>

  <script>
    const API_BASE = "https://api.sxtream.xyz/downloader";
    const preview = document.getElementById("preview");
    const downloadBtn = document.getElementById("downloadBtn");
    const openBtn = document.getElementById("openBtn");

    let lastUrl = null;
    let lastBlob = null;

    document.getElementById("fetchBtn").addEventListener("click", async () => {
      const platform = document.getElementById("platform").value;
      const inputUrl = document.getElementById("urlInput").value.trim();
      if(!inputUrl) return alert("Masukkan URL dulu");

      resetState();
      preview.textContent = "Memproses...";

      try {
        const apiUrl = `${API_BASE}/${platform}?url=${encodeURIComponent(inputUrl)}`;
        const res = await fetch(apiUrl);
        if(!res.ok) throw new Error("HTTP "+res.status);

        const ctype = res.headers.get("content-type")||"";
        if(ctype.includes("json")){
          const data = await res.json();
          // ambil url video dari berbagai kemungkinan field
          const candidates = [
            data.result?.video?.noWatermark,
            data.result?.video?.watermark,
            data.url,
            data.downloadUrl,
            data.result?.downloadUrl,
            data.link
          ].filter(Boolean);
          if(!candidates.length) throw new Error("Link tidak ditemukan");
          lastUrl = candidates[0];
          tryFetchBlob(lastUrl);
        }else if(ctype.startsWith("video/")||ctype.startsWith("image/")){
          const blob = await res.blob();
          lastBlob = blob;
          lastUrl = URL.createObjectURL(blob);
          renderPreview(ctype,lastUrl);
        }else{
          const text = await res.text();
          preview.textContent="Response tidak valid / diblokir (HTML).";
          console.warn(text.slice(0,200));
        }
      } catch(e){
        preview.textContent="Error: "+e.message;
        console.error(e);
      }
    });

    function resetState(){
      lastUrl=null;lastBlob=null;
      downloadBtn.style.display="none";
      openBtn.style.display="none";
    }
    function renderPreview(type,url){
      if(type.startsWith("video/")){
        preview.innerHTML=`<video controls src="${url}" style="width:100%"></video>`;
      }else if(type.startsWith("image/")){
        preview.innerHTML=`<img src="${url}" style="width:100%">`;
      }else{
        preview.innerHTML=`<div>File siap didownload</div>`;
      }
      downloadBtn.style.display="block";
      openBtn.style.display="block";
    }
    async function tryFetchBlob(url){
      try{
        const r=await fetch(url);
        const blob=await r.blob();
        lastBlob=blob;
        lastUrl=URL.createObjectURL(blob);
        renderPreview(blob.type,lastUrl);
      }catch(err){
        console.warn("Blob gagal, fallback ke link:",err);
        preview.innerHTML=`<a href="${url}" target="_blank" style="color:#38bdf8">Buka di tab baru</a>`;
        lastBlob=null;
        lastUrl=url;
        downloadBtn.style.display="block";
        openBtn.style.display="block";
      }
    }

    downloadBtn.addEventListener("click",()=>{
      if(lastBlob){
        const a=document.createElement("a");
        a.href=URL.createObjectURL(lastBlob);
        a.download="video.mp4";
        a.click();
      }else if(lastUrl){
        const a=document.createElement("a");
        a.href=lastUrl;
        a.download="video.mp4";
        a.click();
      }
    });
    openBtn.addEventListener("click",()=>{
      if(lastUrl) window.open(lastUrl,"_blank");
    });
  </script>
</body>
</html>
