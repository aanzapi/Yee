<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Aanz Downloader</title>
  <style>
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,sans-serif;background:linear-gradient(135deg,#0f172a,#1e293b);color:#f8fafc;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .container{width:100%;max-width:800px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.07);border-radius:16px;padding:28px;backdrop-filter:blur(12px);box-shadow:0 20px 40px rgba(0,0,0,0.6)}
    h1{margin:0 0 10px;font-size:28px;color:#f1f5f9;text-align:center}
    p{text-align:center;margin:0 0 22px;color:#94a3b8;font-size:15px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    select,input,button{padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.08);font-size:14px}
    select,input{flex:1;min-width:180px;background:rgba(255,255,255,0.06);color:#f8fafc}
    button{background:linear-gradient(90deg,#3b82f6,#6366f1);color:#fff;font-weight:600;cursor:pointer;transition:0.2s}
    button:hover{opacity:0.9;transform:translateY(-1px)}
    .preview{margin-top:18px;border-radius:12px;overflow:hidden;background:#000;display:flex;align-items:center;justify-content:center;min-height:220px;text-align:center;color:#94a3b8}
    .actions{display:flex;gap:12px;margin-top:16px}
    .actions button{flex:1;background:#1e293b;color:#f8fafc;border:none;border-radius:10px;padding:10px;cursor:pointer}
    footer{margin-top:22px;text-align:center;font-size:13px;color:#64748b}
    video,img{max-width:100%;height:auto}
  </style>
</head>
<body>
  <div class="container">
    <h1>Aanz Downloader</h1>
    <p>Download video dari <strong>YouTube</strong>, <strong>Instagram</strong>, dan <strong>TikTok</strong> secara instan.</p>

    <div class="row">
      <select id="platform">
        <option value="ytmp4">YouTube</option>
        <option value="instagram">Instagram</option>
        <option value="tiktok">TikTok</option>
      </select>
      <input id="urlInput" placeholder="Tempel URL video di sini"/>
      <button id="fetchBtn">Fetch</button>
    </div>

    <div id="preview" class="preview">Preview akan tampil di sini</div>

    <div class="actions">
      <button id="downloadBtn" style="display:none">‚¨áÔ∏è Download</button>
      <button id="openBtn" style="display:none">üîó Buka</button>
    </div>

    <footer>&lt;/&gt; 2025 Aanz</footer>
  </div>

  <script>
    const API_BASE = "https://api.sxtream.xyz/downloader";
    const fetchBtn = document.getElementById('fetchBtn');
    const platformEl = document.getElementById('platform');
    const urlInput = document.getElementById('urlInput');
    const preview = document.getElementById('preview');
    const downloadBtn = document.getElementById('downloadBtn');
    const openBtn = document.getElementById('openBtn');

    let lastBlob=null,lastUrl=null,lastIsBlob=false;

    function isHttpUrl(s){try{new URL(s);return true}catch{return false}}

    function collectUrls(obj,out=[]){
      if(!obj)return out;
      if(typeof obj==="string"){if(isHttpUrl(obj.trim()))out.push(obj.trim());return out}
      if(Array.isArray(obj)){obj.forEach(v=>collectUrls(v,out));return out}
      if(typeof obj==="object"){for(const k in obj)collectUrls(obj[k],out)}
      return out
    }

    function scoreUrl(u){
      const s=u.toLowerCase();let sc=0;
      if(/\.(mp4|webm|mov)(\?.*)?$/.test(s))sc+=5;
      if(s.includes("nowm")||s.includes("nowatermark"))sc+=8;
      if(s.includes("tiktokcdn")||s.includes("cdninstagram")||s.includes("fbcdn"))sc+=4;
      return sc
    }

    function pickBestUrl(list){
      if(!list.length)return null;
      return list.sort((a,b)=>scoreUrl(b)-scoreUrl(a))[0]
    }

    async function fetchAndPreview(resourceUrl){
      try{
        const res=await fetch(resourceUrl);
        if(!res.ok)throw new Error("HTTP "+res.status);
        const blob=await res.blob();
        lastBlob=blob;lastIsBlob=true;lastUrl=URL.createObjectURL(blob);
        const type=(res.headers.get("content-type")||"").toLowerCase();
        if(type.startsWith("video/"))preview.innerHTML=`<video controls src="${lastUrl}"></video>`;
        else if(type.startsWith("image/"))preview.innerHTML=`<img src="${lastUrl}"/>`;
        else preview.textContent="File siap diunduh.";
        showActions(true)
      }catch{
        lastBlob=null;lastIsBlob=false;lastUrl=resourceUrl;
        preview.innerHTML=`<a href="${resourceUrl}" target="_blank" style="color:#3b82f6">Buka di tab baru</a>`;
        showActions(true)
      }
    }

    function showActions(s){downloadBtn.style.display=openBtn.style.display=s?"block":"none"}

    fetchBtn.addEventListener("click",async()=>{
      const platform=platformEl.value;
      const input=urlInput.value.trim();
      if(!input)return alert("Masukkan URL dulu!");
      preview.textContent="Memproses...";showActions(false);
      lastBlob=null;lastUrl=null;lastIsBlob=false;
      try{
        const resp=await fetch(`${API_BASE}/${platform}?url=${encodeURIComponent(input)}`);
        if(!resp.ok)throw new Error("API "+resp.status);
        const ctype=(resp.headers.get("content-type")||"").toLowerCase();
        if(ctype.includes("json")){
          const j=await resp.json();
          const urls=collectUrls(j);
          const best=pickBestUrl(urls);
          if(best)return fetchAndPreview(best);
          preview.textContent="Link tidak ditemukan."
        }else if(ctype.startsWith("video/")||ctype.startsWith("image/")){
          const blob=await resp.blob();lastBlob=blob;lastIsBlob=true;lastUrl=URL.createObjectURL(blob);
          if(ctype.startsWith("video/"))preview.innerHTML=`<video controls src="${lastUrl}"></video>`;
          else preview.innerHTML=`<img src="${lastUrl}"/>`;
          showActions(true)
        }else preview.textContent="Respon tidak valid."
      }catch(e){preview.textContent="Gagal memuat: "+e.message}
    });

    downloadBtn.addEventListener("click",async()=>{
      if(lastIsBlob&&lastBlob)saveBlob(lastBlob,"download.mp4");
      else if(lastUrl){
        try{const r=await fetch(lastUrl);saveBlob(await r.blob(),"download.mp4")}
        catch{window.open(lastUrl,"_blank")}
      }
    });
    openBtn.addEventListener("click",()=>{if(lastUrl)window.open(lastUrl,"_blank")});

    function saveBlob(blob,name){const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download=name;a.click();setTimeout(()=>URL.revokeObjectURL(url),1500)}
  </script>
</body>
</html>
